<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ğŸ’° Balans AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="app">
        <!-- Content Sections -->
        <main class="main-content">
            <!-- Home Tab -->
            <section id="home" class="tab-content active">
                <!-- Tariff Badge -->
                <div class="tariff-badge" id="tariffBadge">
                    <span class="tariff-icon">â­</span>
                    <span class="tariff-text" id="tariffText">FREE</span>
                    <button class="upgrade-btn" id="upgradeBtn" onclick="app.showUpgradeModal()">
                        Upgrade
                    </button>
                </div>

                <!-- Balance Card - Wallet Style -->
                <div class="wallet-balance-card">
                    <div class="balance-header">
                        <div class="balance-label">Joriy balans</div>
                        <div class="balance-menu">
                            <button class="menu-dot" onclick="app.showBalanceMenu()">â‹¯</button>
                        </div>
                    </div>
                    <div class="balance-amount" id="mainBalance">0 so'm</div>
                    <div class="balance-change" id="balanceChange">
                        <span class="change-icon">ğŸ“ˆ</span>
                        <span class="change-text">Bu oyda +0%</span>
                    </div>
                </div>

                <!-- Quick Actions - Wallet Style -->
                <div class="wallet-actions">
                    <button class="wallet-action-btn exchange" onclick="app.showAIAnalysis()">
                        <div class="action-icon">ğŸ¤–</div>
                        <div class="action-label">AI Tahlil</div>
                    </button>
                    <button class="wallet-action-btn receive" onclick="app.getAIReport()">
                        <div class="action-icon">ğŸ“Š</div>
                        <div class="action-label">AI Hisobot</div>
                    </button>
                    <button class="wallet-action-btn send" onclick="app.showTab('analytics')">
                        <div class="action-icon">ğŸ“ˆ</div>
                        <div class="action-label">Statistika</div>
                    </button>
                    <button class="wallet-action-btn more" onclick="app.showTab('debts')">
                        <div class="action-icon">ğŸ¦</div>
                        <div class="action-label">Qarzlar</div>
                    </button>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-item income">
                        <div class="stat-icon">ğŸ“ˆ</div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalIncomeHome">0</div>
                            <div class="stat-label">Daromad</div>
                        </div>
                    </div>
                    <div class="stat-item expense">
                        <div class="stat-icon">ğŸ“‰</div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalExpenseHome">0</div>
                            <div class="stat-label">Xarajat</div>
                        </div>
                    </div>
                    <div class="stat-item debt">
                        <div class="stat-icon">ğŸ¦</div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalDebtHome">0</div>
                            <div class="stat-label">Qarzlar</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="recent-section">
                    <div class="section-header">
                        <h3>So'nggi tranzaksiyalar</h3>
                        <button class="view-all-btn" onclick="app.switchTab('transactions')">
                            Barchasi â†’
                        </button>
                    </div>
                    <div class="transaction-list" id="recentTransactionsList">
                        <!-- Recent transactions here -->
                    </div>
                </div>
            </section>

            <!-- Transactions Tab -->
            <section id="transactions" class="tab-content">
                <div class="page-header">
                    <h1>Tranzaksiyalar</h1>
                    <button class="header-btn" onclick="showAddTransactionModal()">
                        <span class="btn-icon">â•</span>
                    </button>
                </div>
                
                <!-- Transaction Filters -->
                <div class="filter-tabs">
                    <button class="filter-tab active" data-filter="all">Barchasi</button>
                    <button class="filter-tab" data-filter="income">Daromad</button>
                    <button class="filter-tab" data-filter="expense">Xarajat</button>
                    <button class="filter-tab" data-filter="debt">Qarz</button>
                </div>

                <div class="transaction-list" id="transactionsList">
                    <!-- Transactions here -->
                </div>
            </section>

            <!-- Analytics Tab -->
            <section id="analytics" class="tab-content">
                <div class="page-header">
                    <h1>Tahlillar</h1>
                    <div class="premium-badge" id="analyticsPremiumBadge">
                        <span class="premium-icon">â­</span>
                        <span>Premium</span>
                    </div>
                </div>

                <!-- AI Analysis Section -->
                <div class="ai-section">
                    <div class="ai-card">
                        <div class="ai-header">
                            <div class="ai-icon">ğŸ¤–</div>
                            <div class="ai-info">
                                <h3>AI Moliyaviy Maslahatchi</h3>
                                <p id="aiLimitText">Kunlik limit: 3/3</p>
                            </div>
                        </div>
                        <button class="ai-btn" id="aiAnalysisBtn" onclick="app.requestAIAnalysis()">
                            Tahlil qilish
                        </button>
                    </div>
                    
                    <div class="ai-result" id="aiResult" style="display: none;">
                        <div class="ai-result-content" id="aiResultContent">
                            <!-- AI analysis result -->
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-section">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>ğŸ“Š Oylik statistika</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="monthlyChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>ğŸ° Kategoriyalar</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>ğŸ“ˆ Haftalik trend</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="weeklyChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>ğŸ’° Daromad vs Xarajat</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="incomeExpenseChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Advanced Analytics (Premium) -->
                <div class="premium-section" id="advancedAnalytics">
                    <div class="premium-lock" id="analyticsLock">
                        <div class="lock-icon">ğŸ”’</div>
                        <h3>Kengaytirilgan tahlillar</h3>
                        <p>Bu funksiya Premium tarifida mavjud</p>
                        <button class="upgrade-btn" onclick="app.showUpgradeModal()">
                            Premium ga o'tish
                        </button>
                    </div>
                    
                    <div class="advanced-analytics-content" id="advancedAnalyticsContent" style="display: none;">
                        <!-- Eng yuqori/past xarajatlar -->
                        <div class="stats-row">
                            <div class="stat-card expense-high">
                                <div class="stat-icon">ğŸ“ˆ</div>
                                <div class="stat-content">
                                    <h4>Eng yuqori xarajat</h4>
                                    <div class="stat-value" id="highestExpense">0 so'm</div>
                                    <div class="stat-detail" id="highestExpenseDetail">Ma'lumot yo'q</div>
                                </div>
                            </div>
                            <div class="stat-card expense-low">
                                <div class="stat-icon">ğŸ“‰</div>
                                <div class="stat-content">
                                    <h4>Eng kam xarajat</h4>
                                    <div class="stat-value" id="lowestExpense">0 so'm</div>
                                    <div class="stat-detail" id="lowestExpenseDetail">Ma'lumot yo'q</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Eng qimmat kun -->
                        <div class="highlight-card">
                            <div class="highlight-icon">ğŸ’¸</div>
                            <div class="highlight-content">
                                <h4>Eng ko'p harajat qilingan kun</h4>
                                <div class="highlight-value" id="mostExpensiveDay">Ma'lumot yo'q</div>
                                <div class="highlight-amount" id="mostExpensiveDayAmount">0 so'm</div>
                            </div>
                        </div>
                        
                        <!-- Kunlik statistika grafigi -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>ğŸ“… Oxirgi 7 kun</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="dailyChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Top kategoriyalar -->
                        <div class="top-categories">
                            <h3>ğŸ† Top kategoriyalar</h3>
                            <div class="category-list" id="topCategories">
                                <!-- Categories will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Goals Tab -->
            <section id="goals" class="tab-content">
                <div class="page-header">
                    <h1>Maqsadlar</h1>
                    <button class="header-btn" onclick="app.showAddGoalModal()">
                        <span class="btn-icon">â•</span>
                    </button>
                </div>

                <!-- Goals Summary -->
                <div class="goals-summary">
                    <div class="summary-card active">
                        <div class="summary-icon">ğŸ¯</div>
                        <div class="summary-content">
                            <h4>Faol maqsadlar</h4>
                            <div class="summary-value" id="activeGoals">0 ta</div>
                        </div>
                    </div>
                    
                    <div class="summary-card completed">
                        <div class="summary-icon">âœ…</div>
                        <div class="summary-content">
                            <h4>Yakunlangan</h4>
                            <div class="summary-value" id="completedGoals">0 ta</div>
                        </div>
                    </div>
                    
                    <div class="summary-card total">
                        <div class="summary-icon">ğŸ’°</div>
                        <div class="summary-content">
                            <h4>Jami jamg'arilgan</h4>
                            <div class="summary-value" id="totalSaved">0 so'm</div>
                        </div>
                    </div>
                </div>

                <!-- Goals List -->
                <div class="goals-list">
                    <h3>ğŸ“‹ Mening maqsadlarim</h3>
                    <div class="goal-items" id="goalItems">
                        <!-- Goals will be loaded here -->
                        <div class="empty-state">
                            <div class="empty-icon">ğŸ¯</div>
                            <h4>Maqsadlar yo'q</h4>
                            <p>Birinchi maqsadingizni qo'shing</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Debts Tab -->
            <section id="debts" class="tab-content">
                <div class="page-header">
                    <h1>Qarzlar</h1>
                </div>

                <!-- Qarzlar xulosasi -->
                <div class="debt-summary">
                    <div class="summary-card total">
                        <div class="summary-icon">ğŸ“Š</div>
                        <div class="summary-content">
                            <h4>Jami qarzlar</h4>
                            <div class="summary-value" id="totalDebts">0 ta</div>
                        </div>
                    </div>
                    
                    <div class="summary-card given">
                        <div class="summary-icon">ğŸ“¤</div>
                        <div class="summary-content">
                            <h4>Bergan qarzlar</h4>
                            <div class="summary-value" id="totalGiven">0 so'm</div>
                        </div>
                    </div>
                    
                    <div class="summary-card received">
                        <div class="summary-icon">ğŸ“¥</div>
                        <div class="summary-content">
                            <h4>Olgan qarzlar</h4>
                            <div class="summary-value" id="totalReceived">0 so'm</div>
                        </div>
                    </div>
                    
                    <div class="summary-card balance">
                        <div class="summary-icon">âš–ï¸</div>
                        <div class="summary-content">
                            <h4>Sof balans</h4>
                            <div class="summary-value" id="netBalance">0 so'm</div>
                        </div>
                    </div>
                </div>

                <!-- Qarzlar ro'yxati -->
                <div class="debts-list">
                    <h3>ğŸ“‹ Qarzlar tarixi</h3>
                    <div class="debt-items" id="debtItems">
                        <!-- Debts will be loaded here -->
                        <div class="empty-state">
                            <div class="empty-icon">ğŸ’°</div>
                            <h4>Qarzlar yo'q</h4>
                            <p>Hali hech qanday qarz ma'lumoti kiritilmagan</p>
                        </div>
                    </div>
                </div>
            </section>

        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-tab="home">
                <div class="nav-icon">ğŸ </div>
                <div class="nav-label">Bosh sahifa</div>
            </button>
            <button class="nav-item" data-tab="transactions">
                <div class="nav-icon">ğŸ’³</div>
                <div class="nav-label">Tranzaksiyalar</div>
            </button>
            <button class="nav-item" data-tab="goals">
                <div class="nav-icon">ğŸ¯</div>
                <div class="nav-label">Maqsadlar</div>
            </button>
            <button class="nav-item" data-tab="analytics">
                <div class="nav-icon">ğŸ“Š</div>
                <div class="nav-label">Tahlillar</div>
            </button>
            <button class="nav-item" data-tab="debts">
                <div class="nav-icon">ğŸ¦</div>
                <div class="nav-label">Qarzlar</div>
            </button>
        </nav>
    </div>

    <!-- Modals -->

    <!-- Upgrade Modal -->
    <div id="upgradeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>â­ Premium ga o'tish</h3>
                <span class="close" onclick="closeModal('upgradeModal')">&times;</span>
            </div>
            <div class="upgrade-content">
                <div class="upgrade-features">
                    <h4>Premium imkoniyatlar:</h4>
                    <div class="feature-list">
                        <div class="feature-item">
                            <span class="feature-icon">âœ…</span>
                            <span>Cheksiz tranzaksiyalar</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">âœ…</span>
                            <span>50 ta AI so'rov kuniga</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">âœ…</span>
                            <span>Kengaytirilgan tahlillar</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">âœ…</span>
                            <span>Ma'lumotlar eksporti</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">âœ…</span>
                            <span>Cheksiz kategoriyalar</span>
                        </div>
                    </div>
                </div>
                <div class="upgrade-price">
                    <div class="price-tag">
                        <span class="price">29,000 so'm</span>
                        <span class="period">/ oyiga</span>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('upgradeModal')">
                        Keyinroq
                    </button>
                    <button type="button" class="btn-primary" onclick="app.upgradeToPremium()">
                        <span class="btn-icon">â­</span>
                        Premium olish
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Analysis Modal -->
    <div id="aiAnalysisModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ¤– AI Tahlil</h3>
                <span class="close" onclick="closeModal('aiAnalysisModal')">&times;</span>
            </div>
            <div class="ai-analysis-content" id="aiAnalysisContent">
                <div class="ai-loading">
                    <div class="loading-spinner"></div>
                    <p>AI tahlil qilmoqda...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Goal Modal -->
    <div id="addGoalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ¯ Yangi maqsad</h3>
                <span class="close" onclick="closeModal('addGoalModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="goalForm">
                    <div class="form-group">
                        <label>Maqsad nomi</label>
                        <input type="text" id="goalName" placeholder="Masalan: iPhone 15" required>
                    </div>
                    <div class="form-group">
                        <label>Maqsad summasi</label>
                        <input type="number" id="goalAmount" placeholder="1000000" required>
                    </div>
                    <div class="form-group">
                        <label>Muddat</label>
                        <input type="date" id="goalDeadline" required>
                    </div>
                    <div class="form-group">
                        <label>Kategoriya</label>
                        <select id="goalCategory">
                            <option value="Texnika">ğŸ“± Texnika</option>
                            <option value="Uy">ğŸ  Uy</option>
                            <option value="Transport">ğŸš— Transport</option>
                            <option value="Ta'lim">ğŸ“š Ta'lim</option>
                            <option value="Sog'liq">ğŸ¥ Sog'liq</option>
                            <option value="Sayohat">âœˆï¸ Sayohat</option>
                            <option value="Boshqa">ğŸ“¦ Boshqa</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('addGoalModal')">
                            Bekor qilish
                        </button>
                        <button type="submit" class="btn-primary">
                            <span class="btn-icon">ğŸ¯</span>
                            Maqsad qo'shish
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ”” Bildirishnomalar</h3>
                <span class="close" onclick="closeModal('notificationsModal')">&times;</span>
            </div>
            <div class="notifications-content" id="notificationsContent">
                <div class="notification-item">
                    <div class="notification-icon">ğŸ’°</div>
                    <div class="notification-text">
                        <h4>Maqsadga yaqinlashdingiz!</h4>
                        <p>iPhone 15 maqsadingizning 80% ga yetdingiz</p>
                        <span class="notification-time">2 soat oldin</span>
                    </div>
                </div>
                <div class="notification-item">
                    <div class="notification-icon">âš ï¸</div>
                    <div class="notification-text">
                        <h4>Qarz eslatmasi</h4>
                        <p>Ahmadga bergan qarzingiz 3 kundan keyin muddati tugaydi</p>
                        <span class="notification-time">1 kun oldin</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>